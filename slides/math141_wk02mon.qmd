---
pagetitle: "The Grammar of Graphics"
editor: source
format: 
  revealjs:
    chalkboard: true
    incremental: true
    theme: [default, custom.scss]
    height: 900
    width: 1600
    slide-number: c
    auto-stretch: false
    callout-appearance: simple
    pdf-max-pages-per-slide: 2
    menu: 
      side: right
      numbers: true
execute:
  echo: true
  warning: false
  message: false
---

```{r}
#| include: false
#| warning: false
#| message: false

knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
                      fig.retina = 3, fig.align = 'center')
library(knitr)
library(tidyverse)
```

::::: columns
::: {.column .center width="60%"}
![](img/DAW.jpeg){width="90%"}
:::

::: {.column .center width="40%"}
<br>

[Intro to `ggplot2`]{.custom-title}

<br> <br> <br> <br> <br>

[Grayson White]{.custom-subtitle}

[Math 141 <br> Week 2 \| Fall 2025]{.custom-subtitle}
:::
:::::

------------------------------------------------------------------------


## Goals for Today

::: nonincremental
-   Recall our motivation for good graphics
-   Learn the general structure of `ggplot2`.
-   Learn a few standard graphs for numerical/quantitative data:
    -   **Histogram**: one numerical variable
    -   **Side-by-side boxplot**: one numerical variable and one categorical variable
    -   **Side-by-side violin plot**: one numerical variable and one categorical variable
    -   **Scatterplot**: two numerical variables
    -   **Linegraph**: two numerical variables
:::

------------------------------------------------------------------------

## Load Necessary Packages

![](img/ggplot2.png){width="15%" fig-align="center"}

`ggplot2` is part of this collection of data science packages.

```{r}
#| message: true
#| warning: true
# Load necessary packages
library(tidyverse)
```

------------------------------------------------------------------------

## Data Setting: [Portland Bikeshare Data](https://biketownpdx.com)

::::: columns
::: {.column width="40%" fig-align="center"}
![](img/bikepdx.jpg){width="100%"}
:::

::: {.column width="60%" fig-align="center"}
![](img/citymap.jpg){width="100%"}
:::
:::::

------------------------------------------------------------------------

## Import the Data

```{r}
biketown <- read_csv("data/biketown.csv")

# Inspect the data
glimpse(biketown)
```




------------------------------------------------------------------------

## Inspect the Data

```{r}
# Look at first few rows
head(biketown)
```

What does a row represent here?

------------------------------------------------------------------------

## Inspect the Data

```{r}
# Determine type
# To access one variable: dataset$variable
class(biketown$BikeName)
class(biketown$Distance_Miles)
class(biketown)

```

------------------------------------------------------------------------

## Grammar of Graphics

::: nonincremental
-   **data**: Data frame that contains the raw data
    -   Variables used in the graph
-   **geom**: Geometric **shape** that the data are mapped to.
    -   EX: Point, line, bar, text, ...
-   **aesthetic**: Visual properties of the **geom**
    -   EX: X (horizontal) position, y (vertical) position, color, fill, shape
-   **scale**: Controls how data are mapped to the visual values of the aesthetic.
    -   EX: particular colors, log scale
-   **guide**: Legend/key to help user convert visual display back to the data
:::

------------------------------------------------------------------------

## `ggplot2` example code

**Guiding Principle**: We will map variables from the **data** to the **aes**thetic attributes (e.g. location, size, shape, color) of **geom**etric objects (e.g. points, lines, bars).

```{r, eval = FALSE, tidy = FALSE}
ggplot(data = ---, mapping = aes(---)) +
  geom_---(---) 
```

-   There are other layers, such as `scale_---_---()` and `labs()`, but we will wait on those.

------------------------------------------------------------------------

## Histograms

::::: columns
::: {.column width="33%"}
-   Binned counts of data.

-   Great for assessing shape.

- **Question**: are histograms used for *quantitative* or *categorical* variables?

- **Answer**: *Quantitative*. 
:::

::: {.column width="66%"}
```{r, echo = FALSE}
# Create histogram
ggplot(data = biketown, mapping = aes(x = Distance_Miles)) +
  geom_histogram()

```
:::
:::::

------------------------------------------------------------------------

## Data Shapes

```{r, echo=FALSE, fig.width = 12, fig.asp = .4}
set.seed(1)
dat <- data_frame(x1 = rf(200,12,8), x2 = rnorm(200), x3 = (-1)*rf(200, 12, 8)+20)
p1 <- ggplot(dat, aes(x = x1)) +
  geom_histogram(bins = 20) +
  labs(title = "Right Skewed Shape")
p2 <- ggplot(dat, aes(x = x2)) +
  geom_histogram(bins = 15) +
  labs(title = "Bell Shaped \nand Symmetric")
p3 <- ggplot(dat, aes(x = x3)) +
  geom_histogram(bins = 15) + 
  labs(title = "Left Skewed Shape")
library(cowplot)
plot_grid(p1, p2, p3, ncol = 3)
```

------------------------------------------------------------------------

## Histograms

```{r hist}
#| output-location: column
# Create histogram
ggplot(data = biketown, 
       mapping = aes(x = Distance_Miles)) +
  geom_histogram()
```

------------------------------------------------------------------------

## Histograms

```{r hist2}
#| output-location: column
#| code-line-numbers: "4-6"
# Create histogram
ggplot(data = biketown, 
       mapping = aes(x = Distance_Miles)) +
  geom_histogram(color = "white",
                 fill = "violetred1",
                 bins = 50)
```

-   **mapping** to a variable goes in `aes()`
-   **setting** to a specific value goes in the `geom_---()`

------------------------------------------------------------------------

## Boxplots

::::: columns
::: {.column width="50%"}
-   **Five number summary**:
    -   Minimum
    -   First quartile (Q1)
    -   Median
    -   Third quartile (Q3)
    -   Maximum
-   Interquartile range (IQR) $=$ Q3 $-$ Q1
-   Outliers: **unusual** points
    -   Boxplot defines unusual as being beyond $1.5*IQR$ from $Q1$ or $Q3$.
-   Whiskers: reach out to the furthest point that is NOT an outlier
:::

::: {.column width="50%"}
```{r echo = FALSE}
ggplot(data = biketown, 
       mapping = aes(x = PaymentPlan, 
                     y = Distance_Miles)) +
  geom_boxplot()
```
:::
:::::

------------------------------------------------------------------------

## Boxplots

```{r}
#| output-location: column
# Create boxplot
ggplot(data = biketown, 
       mapping = aes(x = PaymentPlan, 
                     y = Distance_Miles)) +
  geom_boxplot()
```

------------------------------------------------------------------------

## Boxplots

```{r box2}
#| output-location: column
#| code-line-numbers: "4"
ggplot(data = biketown, 
       mapping = aes(x = PaymentPlan, 
                     y = Distance_Miles)) +
  geom_boxplot(fill = "springgreen3")
```

-   Is this `fill` an `aes`thetic mapping? 

------------------------------------------------------------------------

## Boxplots

```{r box3}
#| output-location: column
#| code-line-numbers: "4"
ggplot(data = biketown, 
       mapping = aes(x = PaymentPlan, 
                     y = Distance_Miles,
                     fill = PaymentPlan)) +
  geom_boxplot()
```

-   Is this `fill` an `aes`thetic mapping? 

-   What variable is mapped to `fill`? 

------------------------------------------------------------------------

## Boxplots

```{r box4}
#| output-location: column
#| code-line-numbers: "6"
ggplot(data = biketown, 
       mapping = aes(x = PaymentPlan, 
                     y = Distance_Miles,
                     fill = PaymentPlan)) +
  geom_boxplot() +
  guides(fill = "none")
```

------------------------------------------------------------------------

## Violin Plots

```{r vio}
#| output-location: column
ggplot(data = biketown, 
       mapping = aes(x = PaymentPlan, 
                     y = Distance_Miles,
                     fill = PaymentPlan)) +
  geom_violin() +
  guides(fill = "none")
```

------------------------------------------------------------------------

## Boxplot Versus Violin Plots

::::: columns
::: {.column width="50%"}
```{r}
#| echo: false
ggplot(data = biketown, 
       mapping = aes(x = PaymentPlan, 
                     y = Distance_Miles,
                     fill = PaymentPlan)) +
  geom_boxplot() +
  guides(fill = "none")
```
:::

::: {.column width="50%"}
```{r}
#| echo: false
ggplot(data = biketown, 
       mapping = aes(x = PaymentPlan, 
                     y = Distance_Miles,
                     fill = PaymentPlan)) +
  geom_violin() +
  guides(fill = "none")
```
:::
:::::

------------------------------------------------------------------------


## New Data Context: `pdxTrees`

-   The `pdxTrees` R package contains data on all the trees in the Portland Metro Area. 
-   Today, we'll look at the Maple, Oak, Pine, Cedar, and Douglas-fir trees in a few parks near Reed. 
-   Let's load the data

## New Data Context: `pdxTrees`

::: {.nonincremental}

-   The `pdxTrees` R package contains data on all the trees in the Portland Metro Area. 
-   Today, we'll look at the Maple, Oak, Pine, Cedar, and Douglas-fir trees in a few parks near Reed. 
-   Let's load the data
-   Don't worry, we haven't learned the below code yet. 

:::

```{r}
library(pdxTrees)
near_Reed <- get_pdxTrees_parks(park = c("Woodstock Park", "Sellwood Riverfront Park", "Kenilworth Park")) %>%
  filter(Genus %in% c("Acer", "Quercus", "Pinus", "Thuja", "Pseudotsuga"))
```

## Inspect the data

```{r}
glimpse(near_Reed)
```

## Inspect the data

```{r}
head(near_Reed)
```

What does a row represent here? 




## Scatterplots

-   Explore relationships between numerical variables.
    -   We will be especially interested in **linear** relationships.

::: fragment
```{r}
#| output-location: column

ggplot(data = near_Reed,
       mapping = aes(x = DBH,
                     y = Carbon_Storage_lb)) +
  geom_point(size = 2)
```
:::

------------------------------------------------------------------------

## Scatterplots

```{r}
#| output-location: column


ggplot(data = near_Reed,
       mapping = aes(x = DBH,
                     y = Carbon_Storage_lb)) +
  geom_point(size = 2, alpha = 0.25)
```

-   Fix over-plotting
-   What's going on in this graph?

------------------------------------------------------------------------

## Scatterplots

```{r}
#| output-location: column


ggplot(data = near_Reed,
       mapping = aes(x = DBH,
                     y = Carbon_Storage_lb,
                     color = Genus)) +
  geom_point(size = 2, alpha = 0.25)
```


------------------------------------------------------------------------

## Linegraphs


```{r}
#| output-location: column


ggplot(data = near_Reed,
       mapping = aes(x = DBH,
                     y = Carbon_Storage_lb)) +
  geom_line(size = 2)
```

## Linegraphs


```{r}
#| output-location: column


ggplot(data = near_Reed,
       mapping = aes(x = DBH,
                     y = Carbon_Storage_lb,
                     color = Genus)) +
  geom_line(size = 2)
```

## Linegraphs vs scatterplots

::::: columns
::: {.column width="50%"}


```{r}
#| echo: false
ggplot(data = near_Reed,
       mapping = aes(x = DBH,
                     y = Carbon_Storage_lb,
                     color = Genus)) +
  geom_line(size = 2)
```
:::

::: {.column width="50%"}

```{r}
#| echo: false
ggplot(data = near_Reed,
       mapping = aes(x = DBH,
                     y = Carbon_Storage_lb,
                     color = Genus)) +
  geom_point(size = 2)
```

:::

::::


- Which do you prefer?
- Does it depend on context?
- Which might be better if we put **time** on the x-axis?


## Recap: `ggplot2`

```{r, eval = FALSE, tidy = FALSE}
library(tidyverse)
ggplot(data = ---, mapping = aes(---)) +
  geom_---(---) 
```


## Next time: 

::: {.nonincremental}

-   More `ggplot2`!

:::


